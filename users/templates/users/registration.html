{% extends "main/base.html" %}

{% block content %}

<section class="registration_form m-5">
	<div class="container border text-center">
		<div class="row m-5 align-items-center">
			<div class="col-4">
				<div class="text-white text-end">
					<h2 for="nicknameFormControl">Nickname</h2>
				</div>
			</div>
			<div class="col-4">
				<input class="form-control" id="nicknameFormControl" type="text" placeholder="nickname" aria-label=".form-control-lg example">
			</div>
		</div>

		<div class="row m-5 align-items-center">
			<div class="col-4">
				<div class="text-white text-end">
					<h2 for="emailFormControl">Email</h2>
				</div>
			</div>
			<div class="col-4">
				<input type="email" class="form-control" id="emailFormControl" placeholder="name@example.com">
			</div>
		</div>

		<div class="row m-5 align-items-center">
			<div class="col-4">
				<div class="text-white text-end">
					<h2 for="passwordFormControl">Password</h2>
				</div>
			</div>
			<div class="col-4">
				<input type="email" class="form-control" id="passwordFormControl" placeholder="password">
			</div>
		</div>

		<div class="row m-5 align-items-center">
			<div class="col-12">
				<button type="button" onclick="registerUser()" class="btn btn-warning ps-5 pe-5" id="registrationButton" data-bs-toogle="popover"
				data-bs-placement="top"
				data-bscuston-class="custom-popover"
				data-bs-title="Fill all fields">Sign Up</button>
			</div>
		</div>
	</div>
</section>

{% csrf_token %}
<script type="text/javascript">
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
	async function registerUser() {
		let url = new URL(window.location.href);
		let nickname = document.getElementById("nicknameFormControl").value;
		let email = document.getElementById("emailFormControl").value;
		let password = document.getElementById("passwordFormControl").value;

		let response = await fetch(url, {
			method: "POST",
			headers:{
				"X-CSRFToken": csrftoken,
				"Content-Type": "application/json"
			},
			body: JSON.stringify({"email": email, "nickname": nickname, "password": password})
		});
		resp_status = await response.json();
		console.log(resp_status);
		if (resp_status.status == "0")
			window.location.href = "{% url 'auth' %}";
		else if (resp_status.status == "1")
			fillFields();
		else if (resp_status.status == "2")
			console.log("User already exists");
	}
	function fillFields() {
		/*const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
		const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))*/
		let popover = new bootstrap.Popover(document.querySelector('[data-bs-toogle="popover"]'));

	}
</script>


{% endblock %}

